#!/usr/bin/env bash

docker_cli_plugin_metadata() {
	local vendor="lanrat"
	local description="list container networks"
	cat <<-EOF
	{"SchemaVersion":"0.1.0","Vendor":"${vendor}","ShortDescription":"${description}"}
EOF
}

usage() {
	echo "Usage: docker net [network_name]"
	echo ""
	echo "List Docker networks with their details. If no network is specified, shows all networks."
	echo ""
	echo "Arguments:"
	echo "  network_name    Name of specific network to inspect (optional)"
}

docker-net() {
	query="$1"
	if [ -z "${1}" ]; then
		query="$(docker network ls --format '{{.Name}}')"
	fi
	docker network inspect --format "{{.Name}}|{{.Driver}}|{{if (index .IPAM.Config)}}{{(index .IPAM.Config 0).Subnet}}{{end}}|{{range \$i, \$v := .Containers}}{{\$v.Name}}:{{\$v.IPv4Address}}|{{end}}" $query | column -ts\|
}

case "$1" in
	docker-cli-plugin-metadata)
		docker_cli_plugin_metadata
		;;
	__complete)
		docker network ls --format '{{.Name}}' | grep -v "^$"
		;;
	*)
		# Check if second argument is help flag
		if [[ "$2" == "--help" || "$2" == "-h" ]]; then
			usage
		else
			docker-net "$2"
		fi
		;;
esac
